# {{ ansible_managed }}

config interface 'loopback'
	option device 'lo'
	option proto 'static'
	option ipaddr '127.0.0.1'
	option netmask '255.0.0.0'

config globals 'globals'
{% if router_ipv6_enabled | default(false) %}
	option ula_prefix 'fd51:3af7:06f2::/48'
{% endif %}
{% if router_packet_steering | default(true) %}
	option packet_steering '1'
{% endif %}

config device
	option name 'br-lan'
	option type 'bridge'
	list ports 'lan1'
	list ports 'lan2'
	list ports 'lan3'

config interface 'lan'
	option device 'br-lan'
	option proto 'static'
	option ipaddr '{{ router_network_lan_ipaddr | default("192.168.1.1") }}'
	option netmask '{{ router_network_lan_netmask | default("255.255.255.0") }}'
{% if router_ipv6_enabled | default(false) %}
	option ip6assign '60'
{% endif %}
{% if not router_ipv6_enabled | default(false) %}
	option ipv6 '0'
{% endif %}

config device
	option name 'wan'
{% if router_network_wan_mac and router_network_wan_mac != '' %}
	option macaddr '{{ router_network_wan_mac }}'
{% endif %}

config interface 'wan'
	option device 'wan'
	option proto '{{ router_network_wan_proto | default("dhcp") }}'
	option peerdns '0'
	option dns '8.8.8.8 1.1.1.1'
{% if not router_ipv6_enabled | default(false) %}
	option ipv6 '0'
	option delegate '0'
{% endif %}

{% if router_vpn_enabled | default(true) %}
# VPN routing table with fallback to WAN
config route 'vpn_fallback'
	option interface 'wan'
	option target '0.0.0.0/0'
	option table 'vpn'

config rule
	option name 'mark0x1'
	option mark '0x1'
	option priority '100'
	option lookup 'vpn'
{% endif %}
